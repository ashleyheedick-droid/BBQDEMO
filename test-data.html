<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Test Data Loader ‚Äì Smoke Sessions</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;600;700;800;900&display=swap');
*{box-sizing:border-box;margin:0;padding:0}
:root{--dark:#0d0806;--dark-card:#1a120e;--gold:#DAA520;--cream:#FFF8DC;--fire-orange:#E25822;--smoke-brown:#8B4513;--emerald:#10B981;--radius:16px;--radius-sm:10px}
body{font-family:'Inter',sans-serif;background:var(--dark);color:var(--cream);min-height:100vh;padding:32px 20px}
body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse at 30% 20%,rgba(139,69,19,.2),transparent 50%);pointer-events:none}
.container{max-width:700px;margin:0 auto;position:relative;z-index:1}
h1{font-family:'Bebas Neue',sans-serif;font-size:36px;color:var(--gold);letter-spacing:2px;text-align:center;margin-bottom:8px}
.subtitle{text-align:center;color:rgba(255,248,220,.5);font-size:14px;margin-bottom:32px}
.section{background:linear-gradient(135deg,var(--dark-card),rgba(26,18,14,.95));border:2px solid rgba(218,165,32,.15);border-radius:var(--radius);padding:24px;margin-bottom:20px;position:relative;overflow:hidden}
.section::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--gold),var(--fire-orange),var(--gold))}
.section h2{font-family:'Bebas Neue',sans-serif;font-size:24px;color:var(--gold);letter-spacing:1px;margin-bottom:16px;display:flex;align-items:center;gap:10px}
.test-item{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:rgba(0,0,0,.3);border:1px solid rgba(218,165,32,.1);border-radius:var(--radius-sm);margin-bottom:10px;gap:12px}
.test-item:last-child{margin-bottom:0}
.test-info{flex:1}
.test-name{font-size:14px;font-weight:700;color:var(--cream);margin-bottom:3px}
.test-detail{font-size:11px;color:rgba(255,248,220,.4)}
.test-error{font-size:11px;color:#ef4444;margin-top:4px;font-weight:600}
.status-dot{width:12px;height:12px;border-radius:50%;flex-shrink:0;background:rgba(255,248,220,.15);border:2px solid rgba(255,248,220,.1);transition:all .3s}
.status-dot.pending{background:rgba(245,158,11,.3);border-color:rgba(245,158,11,.5)}
.status-dot.success{background:var(--emerald);border-color:var(--emerald);box-shadow:0 0 12px rgba(16,185,129,.4)}
.status-dot.error{background:#ef4444;border-color:#ef4444;box-shadow:0 0 12px rgba(239,68,68,.4)}
.btn{width:100%;padding:16px;border:none;border-radius:var(--radius-sm);font-size:16px;font-weight:800;font-family:'Inter',sans-serif;cursor:pointer;transition:all .25s;text-transform:uppercase;letter-spacing:1px;margin-bottom:12px}
.btn-send{background:linear-gradient(135deg,var(--fire-orange),var(--smoke-brown));color:#fff;box-shadow:0 8px 24px rgba(226,88,34,.3),0 0 0 2px var(--gold)}
.btn-send:hover:not(:disabled){transform:translateY(-3px);box-shadow:0 12px 32px rgba(226,88,34,.4),0 0 0 2px var(--gold)}
.btn-send:disabled{opacity:.5;cursor:not-allowed}
.btn-read{background:rgba(0,0,0,.4);color:var(--gold);border:2px solid rgba(218,165,32,.3)}
.btn-read:hover:not(:disabled){background:rgba(218,165,32,.12);border-color:var(--gold);transform:translateY(-2px)}
.btn-read:disabled{opacity:.5;cursor:not-allowed}
.progress{text-align:center;color:var(--gold);font-size:14px;font-weight:700;margin:16px 0;min-height:20px}
.results{display:none;margin-top:20px;padding:16px;background:rgba(0,0,0,.4);border:1px solid rgba(218,165,32,.15);border-radius:var(--radius-sm);max-height:400px;overflow-y:auto;font-size:12px;font-family:'Courier New',monospace;color:rgba(255,248,220,.7);white-space:pre-wrap;word-break:break-all}
.results.show{display:block}
.summary{margin-top:24px;padding:20px;background:linear-gradient(135deg,rgba(16,185,129,.08),rgba(16,185,129,.02));border:1px solid rgba(16,185,129,.2);border-radius:var(--radius);text-align:center;display:none}
.summary.show{display:block}
.summary h3{font-family:'Bebas Neue',sans-serif;font-size:24px;color:var(--emerald);margin-bottom:8px}
.summary p{font-size:13px;color:rgba(255,248,220,.6);line-height:1.6}
.back-link{display:block;text-align:center;margin-top:24px;color:var(--gold);font-size:13px;font-weight:700;text-decoration:none}
.back-link:hover{opacity:.7}
</style>
</head>
<body>
<div class="container">
  <h1>Test Data Loader</h1>
  <div class="subtitle">Send sample data to your Google Sheet to preview everything</div>

  <!-- WAITLIST -->
  <div class="section">
    <h2>üìã Waitlist Entries (3)</h2>
    <div class="test-item"><div class="test-info"><div class="test-name">Test Tina</div><div class="test-detail">Party of 4 ¬∑ Spicy ¬∑ "Birthday party!"</div></div><span class="status-dot" id="wl1"></span></div>
    <div class="test-item"><div class="test-info"><div class="test-name">Brisket Carl</div><div class="test-detail">Party of 2 ¬∑ Mild ¬∑ "Shellfish allergy for one guest"</div></div><span class="status-dot" id="wl2"></span></div>
    <div class="test-item"><div class="test-info"><div class="test-name">Turbo Hot Tony</div><div class="test-detail">Party of 6 ¬∑ Turbo Hot ¬∑ "Wants the hottest you got"</div></div><span class="status-dot" id="wl3"></span></div>
  </div>

  <!-- FEEDBACK -->
  <div class="section">
    <h2>üìù Feedback Entries (3)</h2>
    <div class="test-item"><div class="test-info"><div class="test-name">Happy Hannah ‚Äî 5 Stars</div><div class="test-detail">"Best brisket in town! Marcus killed it tonight."</div></div><span class="status-dot" id="fb1"></span></div>
    <div class="test-item"><div class="test-info"><div class="test-name">Honest Henry ‚Äî 3 Stars</div><div class="test-detail">"Food was good but wait was a bit long for a Tuesday."</div></div><span class="status-dot" id="fb2"></span></div>
    <div class="test-item"><div class="test-info"><div class="test-name">Regular Rachel ‚Äî 4 Stars</div><div class="test-detail">"Love the atmosphere and the new specials menu!"</div></div><span class="status-dot" id="fb3"></span></div>
  </div>

  <!-- SHOUTOUTS -->
  <div class="section">
    <h2>‚≠ê Staff Shoutouts (3)</h2>
    <div class="test-item"><div class="test-info"><div class="test-name">Brooke ‚Äî from The Johnsons</div><div class="test-detail">"Brooke made our anniversary dinner perfect!"</div></div><span class="status-dot" id="sh1"></span></div>
    <div class="test-item"><div class="test-info"><div class="test-name">Marcus ‚Äî from Foodie Frank</div><div class="test-detail">"That etouffee was life changing"</div></div><span class="status-dot" id="sh2"></span></div>
    <div class="test-item"><div class="test-info"><div class="test-name">Whole Team ‚Äî from Mama Michelle</div><div class="test-detail">"My kids had the best time. Everyone was so welcoming!"</div></div><span class="status-dot" id="sh3"></span></div>
  </div>

  <!-- CHAT LOGS -->
  <div class="section">
    <h2>ü§ñ Chat Logs (4)</h2>
    <div class="test-item"><div class="test-info"><div class="test-name">"What meats are on the smoker today?"</div><div class="test-detail">Sentiment: neutral</div></div><span class="status-dot" id="ch1"></span></div>
    <div class="test-item"><div class="test-info"><div class="test-name">"How long is the wait right now?"</div><div class="test-detail">Sentiment: neutral</div></div><span class="status-dot" id="ch2"></span></div>
    <div class="test-item"><div class="test-info"><div class="test-name">"Do you have gluten free options?"</div><div class="test-detail">Sentiment: neutral</div></div><span class="status-dot" id="ch3"></span></div>
    <div class="test-item"><div class="test-info"><div class="test-name">"The brisket was AMAZING tonight!"</div><div class="test-detail">Sentiment: happy</div></div><span class="status-dot" id="ch4"></span></div>
  </div>

  <div class="progress" id="progress"></div>
  <button class="btn btn-send" id="sendBtn" onclick="sendAllTestData()">Send All Test Data</button>
  <button class="btn btn-read" id="readBtn" onclick="readAllData()">Read Back &amp; Verify</button>

  <div class="summary" id="summary">
    <h3>All Test Data Sent!</h3>
    <p id="summaryText">Check your Google Sheet to see the data in Waitlist, Feedback, Shoutouts, and ChatLogs tabs. Then click "Read Back & Verify" to confirm the API returns everything correctly.</p>
  </div>

  <div class="results" id="results"></div>

  <a href="pit-control-center.html" class="back-link">‚Üê Back to Control Center</a>
</div>

<script>
var APPS = localStorage.getItem('appsScriptUrl') || '';

if (!APPS) {
  document.getElementById('progress').textContent = 'No Apps Script URL found! Set it in the Control Center first.';
  document.getElementById('sendBtn').disabled = true;
  document.getElementById('readBtn').disabled = true;
}

var testData = {
  waitlist: [
    {id:'wl1', params:{action:'addToWaitlist',name:'Test Tina',phone:'5045551234',partySize:'4',specialNotes:'Birthday party!',spiceLevel:'Spicy',smsConsent:'Yes',marketingOptIn:'No'}},
    {id:'wl2', params:{action:'addToWaitlist',name:'Brisket Carl',phone:'5045559876',partySize:'2',specialNotes:'Shellfish allergy for one guest',spiceLevel:'Mild',smsConsent:'Yes',marketingOptIn:'Yes'}},
    {id:'wl3', params:{action:'addToWaitlist',name:'Turbo Hot Tony',phone:'5045554321',partySize:'6',specialNotes:'Wants the hottest you got',spiceLevel:'Turbo Hot',smsConsent:'Yes',marketingOptIn:'No'}}
  ],
  feedback: [
    {id:'fb1', params:{action:'addFeedback',rating:'5',text:'Best brisket in town! Marcus killed it tonight.',categories:'Food Quality, Service',from:'Happy Hannah',email:'hannah@test.com',sentiment:'happy'}},
    {id:'fb2', params:{action:'addFeedback',rating:'3',text:'Food was good but wait was a bit long for a Tuesday.',categories:'Wait Time, Food Quality',from:'Honest Henry',email:'',sentiment:'neutral'}},
    {id:'fb3', params:{action:'addFeedback',rating:'4',text:'Love the atmosphere and the new specials menu. Will be back!',categories:'Atmosphere, Value',from:'Regular Rachel',email:'',sentiment:'happy'}}
  ],
  shoutouts: [
    {id:'sh1', params:{action:'addShoutout',staff:'Buck',reasons:'Amazing Service, So Friendly',message:'Buck made our anniversary dinner perfect!',from:'The Johnsons'}},
    {id:'sh2', params:{action:'addShoutout',staff:'Big Earl',reasons:'Incredible Food, Went Above & Beyond',message:'That brisket was life changing',from:'Foodie Frank'}},
    {id:'sh3', params:{action:'addShoutout',staff:'The Whole Crew',reasons:'Made My Day, Kid-Friendly',message:'My kids had the best time. Everyone was so welcoming!',from:'Mama Michelle'}}
  ],
  chats: [
    {id:'ch1', params:{action:'logChat',question:'What meats are on the smoker today?',sentiment:'neutral'}},
    {id:'ch2', params:{action:'logChat',question:'How long is the wait right now?',sentiment:'neutral'}},
    {id:'ch3', params:{action:'logChat',question:'Do you have gluten free options?',sentiment:'neutral'}},
    {id:'ch4', params:{action:'logChat',question:'The brisket was AMAZING tonight!',sentiment:'happy'}}
  ]
};

function jsonp(params) {
  return new Promise(function(resolve, reject) {
    var cb = 'test_' + Math.random().toString(36).slice(2);
    var qs = new URLSearchParams(params);
    qs.set('callback', cb);
    var s = document.createElement('script');
    s.src = APPS + '?' + qs.toString();
    var timer = setTimeout(function() {
      delete window[cb]; s.remove();
      reject(new Error('Timeout'));
    }, 15000);
    window[cb] = function(data) {
      clearTimeout(timer); delete window[cb]; s.remove();
      resolve(data);
    };
    s.onerror = function() {
      clearTimeout(timer); delete window[cb]; s.remove();
      reject(new Error('Network error'));
    };
    document.body.appendChild(s);
  });
}

function setDot(id, state, errorMsg) {
  var el = document.getElementById(id);
  if (el) el.className = 'status-dot ' + state;
  // Show error message next to the item
  var item = el ? el.closest('.test-item') : null;
  if (item) {
    var existing = item.querySelector('.test-error');
    if (existing) existing.remove();
    if (state === 'error' && errorMsg) {
      var errEl = document.createElement('div');
      errEl.className = 'test-error';
      errEl.textContent = errorMsg;
      item.querySelector('.test-info').appendChild(errEl);
    }
  }
}

async function sendAllTestData() {
  var btn = document.getElementById('sendBtn');
  var prog = document.getElementById('progress');
  btn.disabled = true;
  btn.textContent = 'Sending...';

  // Clear any previous error messages
  document.querySelectorAll('.test-error').forEach(function(el) { el.remove(); });

  var all = [].concat(testData.waitlist, testData.feedback, testData.shoutouts, testData.chats);
  var sent = 0;
  var failed = 0;
  var errors = [];

  for (var i = 0; i < all.length; i++) {
    var item = all[i];
    setDot(item.id, 'pending');
    prog.textContent = 'Sending ' + (i + 1) + ' of ' + all.length + '...';
    try {
      var resp = await jsonp(item.params);
      if (resp && resp.success) {
        setDot(item.id, 'success');
        sent++;
      } else {
        var errMsg = (resp && resp.error) ? resp.error : 'API returned success=false';
        setDot(item.id, 'error', errMsg);
        errors.push(item.params.action + ': ' + errMsg);
        failed++;
      }
    } catch (e) {
      setDot(item.id, 'error', e.message);
      errors.push(item.params.action + ': ' + e.message);
      failed++;
    }
  }

  prog.textContent = 'Done! ' + sent + ' sent, ' + failed + ' failed.';

  if (failed === 0) {
    btn.textContent = 'All Sent!';
    document.getElementById('summary').classList.add('show');
  } else {
    btn.textContent = 'Retry Send (' + failed + ' failed)';
    btn.disabled = false;
    // Show error summary in results area
    var resultsEl = document.getElementById('results');
    resultsEl.textContent = 'ERRORS:\n' + errors.join('\n');
    resultsEl.classList.add('show');
  }
}

async function readAllData() {
  var btn = document.getElementById('readBtn');
  var prog = document.getElementById('progress');
  var resultsEl = document.getElementById('results');
  btn.disabled = true;
  btn.textContent = 'Reading...';
  prog.textContent = 'Fetching all data from Google Sheets...';

  var endpoints = ['getWaitlist', 'getFeedback', 'getShoutouts', 'getChatLogs', 'getDashboardStats', 'getInventory'];
  var output = '';

  for (var i = 0; i < endpoints.length; i++) {
    var action = endpoints[i];
    prog.textContent = 'Reading ' + action + '...';
    try {
      var resp = await jsonp({action: action});
      output += '=== ' + action + ' ===\n';
      if (resp && resp.success) {
        if (Array.isArray(resp.data)) {
          output += resp.data.length + ' records returned:\n';
          resp.data.forEach(function(row, idx) {
            output += '  [' + (idx+1) + '] ' + JSON.stringify(row) + '\n';
          });
        } else {
          output += JSON.stringify(resp.data, null, 2) + '\n';
        }
      } else {
        output += 'ERROR: ' + JSON.stringify(resp) + '\n';
      }
      output += '\n';
    } catch (e) {
      output += '=== ' + action + ' ===\nFAILED: ' + e.message + '\n\n';
    }
  }

  resultsEl.textContent = output;
  resultsEl.classList.add('show');
  prog.textContent = 'All reads complete!';
  btn.disabled = false;
  btn.textContent = 'Read Back & Verify';
}
</script>
</body>
</html>
